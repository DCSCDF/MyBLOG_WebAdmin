# 角色与权限组接口对接说明

本文档说明前端后台项目与后端「角色与权限组管理」API 的对接方式，便于维护与扩展。

---

## 一、项目结构

### 1. API 层（`src/api/system/`）

| 文件 | 说明 |
|------|------|
| `roleApi.js` | 角色管理接口：列表、详情、修改、删除、权限/权限组关联的增删 |
| `permissionGroupApi.js` | 权限组管理接口：列表、详情、修改、删除、关联权限的增删 |

所有请求均通过 `src/utils/request.js` 发送，自动在 header 中携带 token。

### 2. 状态层（`src/stores/`）

| 文件 | 说明 |
|------|------|
| `role.js` | 角色列表、分页、详情、修改、删除、权限/权限组关联操作 |
| `permissiongroup.js` | 权限组列表、分页、详情、修改、删除、关联权限操作（对接真实 API） |
| `permission.js` | 权限列表（用于「权限管理」页及角色/权限组选择权限时的数据源） |

### 3. 页面与组件

| 路径 | 说明 |
|------|------|
| `src/pages/User/Website/System/RoleManagement.vue` | 角色管理页：列表、查看、编辑、删除、权限配置 |
| `src/pages/User/Website/System/PermissionSetting.vue` | 权限管理页：切换「权限列表」与「权限组」 |
| `src/components/Website/System/showpermission.vue` | 权限列表展示（权限管理页内） |
| `src/components/Website/System/permissiongroup.vue` | 权限组管理：列表、查看、编辑、删除、关联权限 |

### 4. 路由

- **角色管理**：`/user/website/system/role` → `RoleManagement.vue`
- **权限管理**：`/user/website/permissionsetting` → `PermissionSetting.vue`（内含权限列表 + 权限组）

---

## 二、接口与前端对应关系

### 角色管理（`/api/role`）

| 后端接口 | 方法 | 前端调用位置 |
|----------|------|--------------|
| `/api/role/list` | POST | `roleApi.list` → `roleStore.fetchRoles` |
| `/api/role/{id}` | GET | `roleApi.getById` → `roleStore.fetchRoleById` |
| `/api/role/{id}` | PUT | `roleApi.update` → `roleStore.updateRole` |
| `/api/role/{id}` | DELETE | `roleApi.delete` → `roleStore.deleteRole` |
| `/api/role/{id}/permissions-detail` | GET | `roleApi.getPermissionsDetail` → `roleStore.fetchPermissionsDetail` |
| `/api/role/{id}/permissions` | POST | `roleApi.addPermission` → `roleStore.addPermissionToRole` |
| `/api/role/{id}/permissions/{permissionId}` | DELETE | `roleApi.removePermission` → `roleStore.removePermissionFromRole` |
| `/api/role/{id}/permission-groups` | POST | `roleApi.addPermissionGroup` → `roleStore.addPermissionGroupToRole` |
| `/api/role/{id}/permission-groups/{groupId}` | DELETE | `roleApi.removePermissionGroup` → `roleStore.removePermissionGroupFromRole` |

### 权限组管理（`/api/permission-group`）

| 后端接口 | 方法 | 前端调用位置 |
|----------|------|--------------|
| `/api/permission-group/list` | POST | `permissionGroupApi.list` → `permissionGroupStore.fetchPermissionGroups` |
| `/api/permission-group/{id}` | GET | `permissionGroupApi.getById` → `permissionGroupStore.fetchPermissionGroupById` |
| `/api/permission-group/{id}` | PUT | `permissionGroupApi.update` → `permissionGroupStore.updatePermissionGroup` |
| `/api/permission-group/{id}` | DELETE | `permissionGroupApi.delete` → `permissionGroupStore.deletePermissionGroup` |
| `/api/permission-group/{id}/permissions` | GET | `permissionGroupApi.getPermissions` → `permissionGroupStore.fetchGroupPermissions` |
| `/api/permission-group/{id}/permissions` | POST | `permissionGroupApi.addPermission` → `permissionGroupStore.addPermissionToGroup` |
| `/api/permission-group/{id}/permissions/{permissionId}` | DELETE | `permissionGroupApi.removePermission` → `permissionGroupStore.removePermissionFromGroup` |

---

## 三、业务规则（与后端一致）

1. **系统内置**：`isSystem=true` 的角色/权限组仅支持查看，不可修改、删除；前端通过 `record.isSystem` 控制「编辑」「删除」按钮及权限配置中的「添加/移除」。
2. **鉴权**：所有接口需登录，token 由 `request.js` 统一从 `useAuthStore().currentToken` 写入 header；具体所需权限见后端文档（如 `system:role:list`、`system:role:edit` 等）。
3. **删除级联**：删除角色会级联删除用户-角色、角色-权限、角色-权限组关联；删除权限组会级联删除权限-权限组、角色-权限组关联；前端在删除前有二次确认提示。
4. **默认注册角色**：若角色被配置为用户注册默认角色，后端会返回 403 及相应错误信息，前端直接展示 `errorMsg`。

---

## 四、权限码参考（后端）

- **角色**：`system:role:list` | `system:role:edit` | `system:role:delete` | `system:role:addPermission` | `system:role:removePermission` | `system:role:addPermissionGroup` | `system:role:removePermissionGroup`
- **权限组**：`system:permission_group:list` | `system:permission_group:edit` | `system:permission_group:delete` | `system:permission_group:addPermission` | `system:permission_group:removePermission`

前端未单独做权限码校验，由后端根据 token 鉴权；若需在前端隐藏无权限按钮，可在此基础上增加权限码判断。

---

## 五、请求/响应约定

- **分页列表**：请求体 `{ currentPage, pageSize }`，响应 `data` 含 `records`、`total`、`current`、`size`、`pages`。
- **统一响应**：`{ data, success, errorMsg, code }`；`request.js` 在 `success === false` 时 `reject(error)`，组件/Store 中通过 `catch` 或 `message.error(error.message)` 处理。
- **状态**：角色/权限组 `status` 为数字 `0`（禁用）、`1`（启用）；权限组列表展示时在 Store 中转为「启用/禁用」文案，编辑时再以数字提交。

### 5.1 权限组关联权限 `GET /api/permission-group/{id}/permissions`

响应 `data` 为权限数组。**每个权限对象应包含 `permissionGroupId`（或 `groupId`）字段，标识该权限所属的权限组 ID**，与请求路径中的 `{id}` 一致。便于前端在合并多来源数据（如角色权限详情）时区分权限归属、避免重复与混淆。

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 权限 ID |
| code | String | 权限编码 |
| name | String | 权限名称 |
| description | String | 权限描述 |
| sortOrder | Integer | 排序 |
| permissionGroupId / groupId | Long | 所属权限组 ID（与路径 `{id}` 一致） |

以上内容与后端「角色与权限组管理接口文档」一一对应，便于联调与后续修改。
